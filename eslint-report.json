[{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\coverage\\block-navigation.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\coverage\\lcov-report\\block-navigation.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\coverage\\lcov-report\\prettify.js","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":2,"column":14233,"nodeType":"MemberExpression","messageId":"limited","endLine":2,"endColumn":14244,"suggestions":[{"fix":{"range":[14253,14286],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\coverage\\lcov-report\\sorter.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\coverage\\prettify.js","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":2,"column":14233,"nodeType":"MemberExpression","messageId":"limited","endLine":2,"endColumn":14244,"suggestions":[{"fix":{"range":[14253,14286],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\coverage\\sorter.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\eslint.config.cjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src-tauri\\target\\debug\\build\\dsp-planner-9de617a07eb94ba9\\out\\__global-api-script.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\App.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":62,"column":4,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":7,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2683,2686],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2683,2686],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { AppShell } from '@components/layout/AppShell';\r\nimport { Canvas } from '@components/canvas/Canvas';\r\nimport { GameDataEditor } from './components/modals/GameDataEditor/GameDataEditor';\r\nimport { RecipePicker } from './components/modals/RecipePicker/RecipePicker';\r\nimport { ConnectPicker } from './components/modals/ConnectPicker/ConnectPicker';\r\nimport { useLayoutStore } from './stores/layoutStore';\r\nimport { ReactFlowProvider, useReactFlow } from 'reactflow';\r\nimport { DSPIcon } from './components/ui/DSPIcon';\r\nimport { useGameStore } from './stores/gameStore';\r\n\r\nimport { Recipe } from './types/game';\r\n\r\nconst GlobalGhost = () => {\r\n  const draggingItem = useLayoutStore(state => state.draggingItem);\r\n  const { game } = useGameStore();\r\n  const [pos, setPos] = useState({ x: 0, y: 0 });\r\n\r\n  useEffect(() => {\r\n    if (!draggingItem) return;\r\n    const handleMove = (e: MouseEvent) => setPos({ x: e.clientX, y: e.clientY });\r\n    const handleUp = () => {\r\n      // Small delay to let Canvas.onMouseUp fire first if applicable\r\n      setTimeout(() => useLayoutStore.getState().setDraggingItem(null), 50);\r\n    };\r\n    window.addEventListener('mousemove', handleMove);\r\n    window.addEventListener('mouseup', handleUp);\r\n    return () => {\r\n      window.removeEventListener('mousemove', handleMove);\r\n      window.removeEventListener('mouseup', handleUp);\r\n    };\r\n  }, [draggingItem]);\r\n\r\n  if (!draggingItem) return null;\r\n\r\n  return (\r\n    <div\r\n      className=\"fixed pointer-events-none z-[9999] opacity-70 -translate-x-1/2 -translate-y-1/2 border-2 border-primary/50 bg-primary/10 rounded-lg p-2 backdrop-blur-sm\"\r\n      style={{ left: pos.x, top: pos.y }}\r\n    >\r\n      {draggingItem.type === 'splitter' ? (\r\n        <div className=\"w-10 h-10 flex items-center justify-center text-primary\">\r\n          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"3\" strokeLinecap=\"round\" strokeLinejoin=\"round\"><path d=\"M7 11V7a5 5 0 0 1 10 0v4\" /><path d=\"M11 21a2 2 0 1 0 4 0 2 2 0 1 0-4 0\" /><path d=\"M7 21a2 2 0 1 0 4 0 2 2 0 1 0-4 0\" /><path d=\"M11 11v6\" /></svg>\r\n        </div>\r\n      ) : (\r\n        <div className=\"w-10 h-10 flex items-center justify-center\">\r\n          <DSPIcon\r\n            index={game.items.find(i => i.id === (game.recipes.find(r => r.id === draggingItem.recipeId)?.outputs[0]?.itemId || draggingItem.recipeId))?.iconIndex || 0}\r\n            size={32}\r\n          />\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst AppModals = ({\r\n  isEditorOpen,\r\n  setIsEditorOpen,\r\n  isPickerOpen,\r\n  setIsPickerOpen\r\n}: any) => {\r\n  const { project } = useReactFlow();\r\n  const addBlock = useLayoutStore((state) => state.addBlock);\r\n\r\n  const handleRecipeSelect = (recipe: Recipe) => {\r\n    // Project center of window to flow space\r\n    const center = project({\r\n      x: window.innerWidth / 2,\r\n      y: window.innerHeight / 2\r\n    });\r\n    addBlock(recipe.id, center);\r\n    setIsPickerOpen(false);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {isEditorOpen && (\r\n        <div\r\n          className=\"fixed inset-0 z-[100] bg-background/80 flex items-center justify-center p-10 backdrop-blur-sm\"\r\n          onClick={() => setIsEditorOpen(false)}\r\n        >\r\n          <div\r\n            className=\"w-full h-full max-w-6xl border border-border rounded-lg overflow-hidden shadow-2xl relative bg-surface\"\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            <button\r\n              onClick={() => setIsEditorOpen(false)}\r\n              className=\"absolute top-4 right-4 z-10 p-2 bg-red-600/80 hover:bg-red-600 text-white rounded-full transition-colors flex items-center justify-center w-8 h-8\"\r\n            >\r\n              ✕\r\n            </button>\r\n            <GameDataEditor />\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {isPickerOpen && (\r\n        <div\r\n          className=\"fixed inset-0 z-[100] bg-background/80 flex items-center justify-center p-20 backdrop-blur-sm\"\r\n          onClick={() => setIsPickerOpen(false)}\r\n        >\r\n          <div\r\n            className=\"w-full max-w-3xl h-[600px] border border-border rounded-xl overflow-hidden shadow-2xl bg-surface\"\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            <RecipePicker\r\n              onSelect={handleRecipeSelect}\r\n              onCancel={() => setIsPickerOpen(false)}\r\n            />\r\n          </div>\r\n        </div>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nfunction App() {\r\n  const [isEditorOpen, setIsEditorOpen] = useState(false);\r\n  const [isPickerOpen, setIsPickerOpen] = useState(false);\r\n  const activePort = useLayoutStore((state) => state.activePort);\r\n  const setActivePort = useLayoutStore((state) => state.setActivePort);\r\n  const loadFromStorage = useLayoutStore((state) => state.loadFromStorage);\r\n\r\n  // Auto-load on mount\r\n  useEffect(() => {\r\n    loadFromStorage();\r\n  }, [loadFromStorage]);\r\n\r\n  // Global escape key handler to clear all modal states\r\n  useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      if (e.key === 'Escape') {\r\n        setIsEditorOpen(false);\r\n        setIsPickerOpen(false);\r\n        setActivePort(null);\r\n      }\r\n    };\r\n    window.addEventListener('keydown', handleKeyDown);\r\n    return () => window.removeEventListener('keydown', handleKeyDown);\r\n  }, [setActivePort]);\r\n\r\n  return (\r\n    <ReactFlowProvider>\r\n      <AppShell\r\n        onOpenEditor={() => setIsEditorOpen(true)}\r\n        onAddBlock={() => setIsPickerOpen(true)}\r\n      >\r\n        <Canvas />\r\n        <GlobalGhost />\r\n\r\n        <AppModals\r\n          isEditorOpen={isEditorOpen}\r\n          setIsEditorOpen={setIsEditorOpen}\r\n          isPickerOpen={isPickerOpen}\r\n          setIsPickerOpen={setIsPickerOpen}\r\n        />\r\n\r\n        {activePort && (\r\n          <div\r\n            className=\"fixed inset-0 z-[100] bg-background/80 flex items-center justify-center p-20 backdrop-blur-sm\"\r\n            onClick={() => setActivePort(null)}\r\n          >\r\n            <div\r\n              className=\"w-full max-w-xl h-[500px] border border-border rounded-xl overflow-hidden shadow-2xl bg-surface\"\r\n              onClick={(e) => e.stopPropagation()}\r\n            >\r\n              <ConnectPicker\r\n                onCancel={() => setActivePort(null)}\r\n              />\r\n            </div>\r\n          </div>\r\n        )}\r\n      </AppShell>\r\n    </ReactFlowProvider>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\blocks\\Block.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3850,3853],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3850,3853],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { memo, useMemo, useCallback, useRef, useEffect, useState } from 'react';\nimport { NodeProps, Handle, Position } from 'reactflow';\nimport { Block as BlockType, BLOCK_LAYOUT } from '@/types/block';\nimport { useLayoutStore } from '@/stores/layoutStore';\nimport { useGameStore } from '@/stores/gameStore';\nimport { ArrowRight, Activity, Zap, Factory } from 'lucide-react';\nimport { useBlockMetrics } from '@/hooks/useBlockMetrics';\n\r\nimport { BlockHeader } from './parts/BlockHeader';\r\nimport { BlockMachineControls } from './parts/BlockMachineControls';\r\nimport { BlockPortList } from './parts/BlockPortList';\nimport { BlockDetailModal } from './BlockDetailModal';\r\n\r\nconst Block = ({ id, data, selected }: NodeProps<BlockType>) => {\r\n    const { game } = useGameStore();\r\n    const deleteBlock = useLayoutStore((state) => state.deleteBlock);\r\n    const updateBlock = useLayoutStore((state) => state.updateBlock);\r\n    const edges = useLayoutStore((state) => state.edges);\r\n    const onPortClick = useLayoutStore((state) => state.onPortClick);\r\n    const flowMode = useLayoutStore((state) => state.viewSettings.flowMode);\r\n    const machineInputRef = useRef<HTMLInputElement>(null);\r\n    const [showDetailModal, setShowDetailModal] = useState(false);\r\n\r\n    // Lookup data for display\r\n    const recipe = game.recipes.find(r => r.id === data.recipeId);\r\n    const currentMachine = game.machines.find(m => m.id === data.machineId);\r\n\r\n    const { totalPowerWatts, hasConflict, portStates, getItemName, formatPower } = useBlockMetrics(\n        id,\n        data,\n        edges,\n        game.machines,\n        game.items\n    );\n\r\n    // Handlers\r\n    const handleUpdateRate = useCallback((newRate: number) => updateBlock(id, {\r\n        targetRate: newRate,\r\n        calculationMode: 'output'\r\n    }), [id, updateBlock]);\r\n\r\n    const handleUpdateMachineCount = useCallback((count: number) => updateBlock(id, {\r\n        targetMachineCount: count,\r\n        calculationMode: 'machines'\r\n    }), [id, updateBlock]);\r\n\r\n    useEffect(() => {\r\n        const target = machineInputRef.current;\r\n        if (!target) return;\r\n\r\n        const handleWheel = (event: WheelEvent) => {\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n\r\n            const step = event.shiftKey ? 10 : 1;\r\n            const direction = event.deltaY < 0 ? 1 : -1;\r\n            const currentVal = parseFloat(target.value) || 0;\r\n\r\n            const newVal = direction > 0\r\n                ? Math.floor(currentVal + step)\r\n                : Math.ceil(currentVal - step);\r\n\r\n            handleUpdateMachineCount(Math.max(0, newVal));\r\n        };\r\n\r\n        target.addEventListener('wheel', handleWheel, { passive: false });\r\n        return () => target.removeEventListener('wheel', handleWheel);\r\n    }, [handleUpdateMachineCount]);\r\n\r\n    const handleDelete = useCallback(() => deleteBlock(id), [id, deleteBlock]);\r\n\r\n    // Machine Logic\r\n    const alternatives = useMemo(() => {\r\n        return game.machines.filter(m =>\r\n            currentMachine &&\r\n            m.category === currentMachine.category &&\r\n            m.id !== currentMachine.id\r\n        );\r\n    }, [game.machines, currentMachine]);\r\n\r\n    const handleCycleMachine = useCallback(() => {\r\n        if (alternatives.length === 0) return;\r\n        const allInCategory = game.machines.filter(m =>\r\n            currentMachine && m.category === currentMachine.category\r\n        );\r\n        const currentIndex = allInCategory.findIndex(m => m.id === data.machineId);\r\n        const nextIndex = (currentIndex + 1) % allInCategory.length;\r\n        const nextMachine = allInCategory[nextIndex];\r\n\r\n        updateBlock(id, { machineId: nextMachine.id });\r\n    }, [alternatives, currentMachine, game.machines, data.machineId, id, updateBlock]);\r\n\r\n    const handleUpdateModifier = useCallback((mod?: any) => updateBlock(id, { modifier: mod }), [id, updateBlock]);\r\n\r\n    const handlePortClick = useCallback((pid: string) => {\r\n        if (data.inputPorts.some(p => p.id === pid)) {\r\n            onPortClick(id, pid, 'input');\r\n            return;\r\n        }\r\n        if (data.outputPorts.some(p => p.id === pid)) {\r\n            onPortClick(id, pid, 'output');\r\n            return;\r\n        }\r\n    }, [data.inputPorts, data.outputPorts, id, onPortClick]);\r\n\r\n    const handleSetPrimary = useCallback((itemId: string) => updateBlock(id, { primaryOutputId: itemId }), [id, updateBlock]);\r\n\r\n    // Get the primary output item for the badge icon color\r\n    const primaryOutput = data.outputPorts[0];\r\n    const primaryItem = primaryOutput ? game.items.find(i => i.id === primaryOutput.itemId) : null;\r\n    const badgeColor = primaryItem?.color || '#64748b';\r\n\r\n    // ═══════════════════════════════════════════════════════════════════════════\r\n    // FLOW MODE: Compact Badge Rendering\r\n    // ═══════════════════════════════════════════════════════════════════════════\r\n    if (flowMode) {\r\n        const BADGE_WIDTH = 80;\r\n        const BADGE_HEIGHT = 56;\r\n\r\n        return (\r\n            <>\r\n                <div\r\n                    style={{ width: BADGE_WIDTH, height: BADGE_HEIGHT }}\r\n                    className={`\r\n                        flex flex-col items-center justify-center\r\n                        bg-slate-900/90 backdrop-blur-sm border rounded-lg shadow-lg font-mono relative\r\n                        cursor-pointer transition-all duration-200\r\n                        ${selected ? 'border-cyan-500 ring-2 ring-cyan-500/50 shadow-[0_0_15px_rgba(6,182,212,0.3)]' : 'border-slate-700 hover:border-slate-500'}\r\n                        ${hasConflict ? 'border-red-500/70' : ''}\r\n                    `}\r\n                    onClick={() => setShowDetailModal(true)}\r\n                >\r\n                    {/* Accent bar */}\r\n                    <div\r\n                        className=\"absolute top-0 left-0 w-full h-0.5 rounded-t-lg\"\r\n                        style={{ backgroundColor: badgeColor }}\r\n                    />\r\n\r\n                    {/* Recipe Icon + Count */}\r\n                    <div className=\"flex items-center gap-1.5\">\r\n                        <Factory size={18} style={{ color: badgeColor }} />\r\n                        <span className=\"text-white font-black text-lg\">\r\n                            ×{Math.ceil(data.machineCount)}\r\n                        </span>\r\n                    </div>\r\n\r\n                    {/* Output Rate */}\r\n                    <div className=\"text-[10px] text-slate-400 font-bold\">\r\n                        {data.actualRate.toFixed(0)}/m\r\n                    </div>\r\n\r\n                    {/* Invisible handles for connections - centered on badge */}\r\n                    {data.inputPorts.map((port, idx) => (\r\n                        <Handle\r\n                            key={port.id}\r\n                            type=\"target\"\r\n                            position={Position.Left}\r\n                            id={port.id}\r\n                            style={{\r\n                                top: `${30 + (idx * 12)}%`,\r\n                                left: -4,\r\n                                width: 8,\r\n                                height: 8,\r\n                                background: 'transparent',\r\n                                border: 'none',\r\n                            }}\r\n                        />\r\n                    ))}\r\n                    {data.outputPorts.map((port, idx) => (\r\n                        <Handle\r\n                            key={port.id}\r\n                            type=\"source\"\r\n                            position={Position.Right}\r\n                            id={port.id}\r\n                            style={{\r\n                                top: `${30 + (idx * 12)}%`,\r\n                                right: -4,\r\n                                width: 8,\r\n                                height: 8,\r\n                                background: 'transparent',\r\n                                border: 'none',\r\n                            }}\r\n                        />\r\n                    ))}\r\n                </div>\r\n\r\n                {/* Detail Modal */}\r\n                {showDetailModal && (\r\n                    <BlockDetailModal\r\n                        data={data}\r\n                        recipe={recipe}\r\n                        machine={currentMachine}\r\n                        totalPower={totalPowerWatts}\r\n                        hasConflict={hasConflict}\r\n                        onClose={() => setShowDetailModal(false)}\r\n                        onUpdateRate={handleUpdateRate}\r\n                        onUpdateMachineCount={handleUpdateMachineCount}\r\n                        onCycleMachine={handleCycleMachine}\r\n                        onUpdateModifier={handleUpdateModifier}\r\n                        onDelete={handleDelete}\r\n                        formatPower={formatPower}\r\n                        getItemName={getItemName}\r\n                    />\r\n                )}\r\n            </>\r\n        );\r\n    }\r\n\r\n    // ═══════════════════════════════════════════════════════════════════════════\r\n    // STANDARD MODE: Full Block Rendering\r\n    // ═══════════════════════════════════════════════════════════════════════════\r\n    return (\r\n        <div\r\n            style={{ width: data.size.width, minHeight: data.size.height }}\r\n            className={`\r\n                h-auto flex flex-col\r\n                bg-slate-950 border rounded-lg shadow-2xl font-mono relative group transition-all duration-300\r\n                ${selected ? 'border-cyan-500 ring-1 ring-cyan-500/50 shadow-[0_0_20px_rgba(6,182,212,0.25)]' : 'border-slate-800 hover:border-slate-700'}\r\n                ${hasConflict && !selected ? 'border-red-500/50 shadow-[0_0_15px_rgba(244,63,94,0.1)]' : ''}\r\n            `}\r\n        >\r\n            {/* Top Accent Bar */}\r\n            <div className={`absolute top-0 left-0 w-full h-1 rounded-t-lg bg-gradient-to-r ${hasConflict ? 'from-red-600 to-red-400' : (selected ? 'from-cyan-400 to-blue-500' : 'from-slate-700 to-slate-800')}`}></div>\r\n\r\n            {/* HEADER SECTION: Strict Height Enforcement */}\r\n            <div style={{ height: BLOCK_LAYOUT.HEADER }} className=\"flex flex-col flex-none relative z-10\">\r\n                <BlockHeader\r\n                    id={id}\r\n                    recipeId={data.recipeId}\r\n                    label={data.name}\r\n                    subLabel={recipe?.category || 'Production'}\r\n                    targetRate={data.calculationMode === 'output' ? data.targetRate : data.actualRate}\r\n                    calculationMode={data.calculationMode}\r\n                    hasConflict={hasConflict}\r\n                    selected={selected}\r\n                    onDelete={handleDelete}\r\n                    onUpdateRate={handleUpdateRate}\r\n                    height={BLOCK_LAYOUT.HEADER_TOP_HEIGHT}\r\n                />\r\n\r\n                <BlockMachineControls\r\n                    machineName={currentMachine?.name || 'Unknown'}\r\n                    hasAlternatives={alternatives.length > 0}\r\n                    onCycleMachine={handleCycleMachine}\r\n                    modifier={data.modifier}\r\n                    onUpdateModifier={handleUpdateModifier}\r\n                    height={BLOCK_LAYOUT.HEADER_CONTROLS_HEIGHT}\r\n                />\r\n            </div>\r\n\r\n            {/* BODY: The Flow (Input -> Machine -> Output) */}\r\n            <div className=\"flex-1 p-[10px] pt-0 grid grid-cols-[100px_1fr_100px] gap-2 items-stretch relative box-border\">\r\n                <BlockPortList\r\n                    ports={data.inputPorts}\r\n                    side=\"input\"\r\n                    portStates={portStates}\r\n                    getItemName={getItemName}\r\n                    onPortClick={handlePortClick}\r\n                />\r\n\r\n                {/* CENTER: THE MACHINE MATH */}\r\n                <div className=\"relative h-full w-full pointer-events-none\">\r\n                    {/* Spacer to keep consistency if needed, though now purely visual if at all */}\r\n                    <div style={{ height: BLOCK_LAYOUT.PORT_LABEL }} className=\"w-full flex-none\" />\r\n\r\n                    <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 mt-[12px] -z-10 opacity-40 text-slate-900/50\">\r\n                        <ArrowRight size={48} strokeWidth={3} />\r\n                    </div>\r\n\r\n                    {/* Required Count */}\r\n                    <div className={`\r\n                        absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 mt-[12px] pointer-events-auto\r\n                        bg-slate-900 border rounded px-3 py-1 text-center shadow-lg transition-all group-hover:border-cyan-500/20\r\n                        ${data.calculationMode === 'machines' ? 'border-cyan-500/50' : 'border-slate-800'}\r\n                    `}>\r\n                        <div className={`text-[9px] uppercase font-black tracking-widest mb-0.5 transition-colors ${data.calculationMode === 'machines' ? 'text-cyan-500' : 'text-slate-500'}`}>\r\n                            {data.calculationMode === 'machines' ? 'Fixed' : 'Required'}\r\n                        </div>\r\n                        <div className=\"flex items-baseline justify-center\">\r\n                            <input\r\n                                ref={machineInputRef}\r\n                                type=\"number\"\r\n                                step=\"0.1\"\r\n                                value={data.calculationMode === 'machines' ? (data.targetMachineCount ?? data.machineCount) : data.machineCount.toFixed(1)}\r\n                                onChange={(e) => {\r\n                                    handleUpdateMachineCount(parseFloat(e.target.value) || 0);\r\n                                }}\r\n                                className={`\r\n                                    bg-transparent text-xl font-black focus:outline-none w-16 text-center\r\n                                    [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none\r\n                                    nodrag nopan pointer-events-auto transition-all rounded\r\n                                    hover:bg-white/5 focus:bg-white/10 cursor-text\r\n                                    ${data.calculationMode === 'machines' ? 'text-white' : 'text-white/60'}\r\n                                `}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <BlockPortList\r\n                    ports={data.outputPorts}\r\n                    side=\"output\"\r\n                    portStates={portStates}\r\n                    getItemName={getItemName}\r\n                    onPortClick={handlePortClick}\r\n                    primaryOutputId={data.primaryOutputId}\r\n                    onSetPrimary={handleSetPrimary}\r\n                />\r\n            </div>\r\n\r\n            {/* FOOTER: Meta Data */}\r\n            <div style={{ height: BLOCK_LAYOUT.FOOTER }} className=\"mt-auto bg-slate-950/80 border-t border-slate-900 rounded-b-lg px-2.5 flex justify-between items-center text-[9px] font-bold text-slate-500 tracking-wider box-border\">\r\n                <div className=\"flex gap-4\">\r\n                    <span className=\"flex items-center gap-1.5 hover:text-yellow-500 transition-colors\">\r\n                        <Zap size={11} /> {formatPower(totalPowerWatts)}\r\n                    </span>\r\n                    <span className={`flex items-center gap-1.5 transition-colors ${hasConflict ? 'text-red-500 animate-pulse' : 'hover:text-emerald-500'}`}>\r\n                        <Activity size={11} /> {hasConflict ? 'FLOW CONFLICT' : '100% EFFICIENCY'}\r\n                    </span>\r\n                </div>\r\n                <div className=\"px-2 opacity-30 font-mono italic\">#{id.split('-')[0]}</div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default memo(Block);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\blocks\\BlockDetailModal.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\blocks\\__tests__\\Block.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\blocks\\parts\\BlockHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\blocks\\parts\\BlockMachineControls.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\blocks\\parts\\BlockPortList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\blocks\\parts\\__tests__\\BlockHeader.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\blocks\\parts\\__tests__\\BlockMachineControls.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\blocks\\parts\\__tests__\\BlockPortList.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\canvas\\Canvas.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\connections\\ChannelRenderer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\connections\\ConnectionEdge.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\layout\\AppShell.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\layout\\NeedsPanel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\layout\\Sidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\layout\\Toolbar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\layout\\__tests__\\Toolbar.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\modals\\ConnectPicker\\ConnectPicker.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\modals\\GameDataEditor\\BeltForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\modals\\GameDataEditor\\BeltsTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\modals\\GameDataEditor\\GameDataEditor.tsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":118,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":118,"endColumn":20,"suggestions":[{"fix":{"range":[3481,3499],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState } from 'react';\nimport { useGameStore } from '@/stores/gameStore';\nimport { importGameData, exportGameData } from '@/lib/io/gameData';\nimport { useLayoutStore } from '@/stores/layoutStore';\nimport { Item, Recipe, Machine, BeltTier } from '@/types/game';\nimport { ItemForm } from './ItemForm';\nimport { RecipeForm } from './RecipeForm';\nimport { MachineForm } from './MachineForm';\nimport { BeltForm } from './BeltForm';\nimport { ItemsTab } from './ItemsTab';\nimport { RecipesTab } from './RecipesTab';\nimport { MachinesTab } from './MachinesTab';\nimport { BeltsTab } from './BeltsTab';\nimport { PacksTab } from './PacksTab';\n\ntype Tab = 'items' | 'recipes' | 'machines' | 'belts' | 'packs';\n\nexport const GameDataEditor: React.FC = () => {\n    const [activeTab, setActiveTab] = useState<Tab>('items');\n    const [selectedId, setSelectedId] = useState<string | null>(null);\n    const [isCreating, setIsCreating] = useState(false);\n\n    const {\n        game,\n        addItem, updateItem, deleteItem,\n        addRecipe, updateRecipe, deleteRecipe,\n        addMachine, updateMachine, deleteMachine,\n        addBelt, updateBelt, deleteBelt,\n        loadGameData, loadPack, resetToDefault\n    } = useGameStore();\n\n    const { resetLayout } = useLayoutStore();\n\n    useEffect(() => {\n        setSelectedId(null);\n        setIsCreating(false);\n    }, [activeTab]);\n\n    const handleSaveItem = (item: Item) => {\n        if (isCreating) {\n            addItem(item);\n        } else {\n            updateItem(item.id, item);\n        }\n        setSelectedId(null);\n        setIsCreating(false);\n    };\n\n    const handleSaveRecipe = (recipe: Recipe) => {\n        if (isCreating) {\n            addRecipe(recipe);\n        } else {\n            updateRecipe(recipe.id, recipe);\n        }\n        setSelectedId(null);\n        setIsCreating(false);\n    };\n\n    const handleSaveMachine = (machine: Machine) => {\n        if (isCreating) {\n            addMachine(machine);\n        } else {\n            updateMachine(machine.id, machine);\n        }\n        setSelectedId(null);\n        setIsCreating(false);\n    };\n\n    const handleSaveBelt = (belt: BeltTier) => {\n        if (isCreating) {\n            addBelt(belt);\n        } else {\n            updateBelt(belt.id, belt);\n        }\n        setSelectedId(null);\n        setIsCreating(false);\n    };\n\n    const handleDeleteItem = (id: string) => {\n        if (confirm('Are you sure you want to delete this item?')) {\n            deleteItem(id);\n            setSelectedId(null);\n            setIsCreating(false);\n        }\n    };\n\n    const handleDeleteRecipe = (id: string) => {\n        if (confirm('Are you sure you want to delete this recipe?')) {\n            deleteRecipe(id);\n            setSelectedId(null);\n            setIsCreating(false);\n        }\n    };\n\n    const handleDeleteMachine = (id: string) => {\n        if (confirm('Are you sure you want to delete this machine?')) {\n            deleteMachine(id);\n            setSelectedId(null);\n            setIsCreating(false);\n        }\n    };\n\n    const handleDeleteBelt = (id: string) => {\n        if (confirm('Are you sure you want to delete this belt?')) {\n            deleteBelt(id);\n            setSelectedId(null);\n            setIsCreating(false);\n        }\n    };\n\n    const handleCreateClick = () => {\n        setSelectedId(null);\n        setIsCreating(true);\n    };\n\n    const handleExport = () => {\n        const data = exportGameData(game);\n        console.log(data);\n        if (navigator.clipboard) {\n            navigator.clipboard.writeText(data).then(() => alert('Game Data copied to clipboard!')).catch(err => console.error(err));\n        } else {\n            alert('Check console for exported data.');\n        }\n    };\n\n    const handleImport = () => {\n        const json = prompt('Paste Game Data JSON (full export):');\n        if (json) {\n            const result = importGameData(json);\n            if (result.success && result.data) {\n                loadGameData(result.data);\n                alert('Game Data imported successfully!');\n            } else {\n                alert('Import failed: ' + result.error);\n            }\n        }\n    };\n\n    const renderEditor = () => {\n        if (activeTab === 'items') {\n            const selectedItem = selectedId ? game.items.find((item) => item.id === selectedId) : null;\n            if (selectedId && !selectedItem && !isCreating) return <div>Item not found</div>;\n\n            if (selectedItem || isCreating) {\n                return (\n                    <ItemForm\n                        initialData={selectedItem}\n                        isCreating={isCreating}\n                        onSave={handleSaveItem}\n                        onDelete={handleDeleteItem}\n                        onCancel={() => { setSelectedId(null); setIsCreating(false); }}\n                    />\n                );\n            }\n        }\n\n        if (activeTab === 'recipes') {\n            const selectedRecipe = selectedId ? game.recipes.find((recipe) => recipe.id === selectedId) : null;\n            if (selectedId && !selectedRecipe && !isCreating) return <div>Recipe not found</div>;\n\n            if (selectedRecipe || isCreating) {\n                return (\n                    <RecipeForm\n                        initialData={selectedRecipe}\n                        isCreating={isCreating}\n                        availableItems={game.items}\n                        availableMachines={game.machines}\n                        settings={game.settings}\n                        onSave={handleSaveRecipe}\n                        onDelete={handleDeleteRecipe}\n                        onCancel={() => { setSelectedId(null); setIsCreating(false); }}\n                    />\n                );\n            }\n        }\n\n        if (activeTab === 'machines') {\n            const selectedMachine = selectedId ? game.machines.find((machine) => machine.id === selectedId) : null;\n            if (selectedId && !selectedMachine && !isCreating) return <div>Machine not found</div>;\n\n            if (selectedMachine || isCreating) {\n                return (\n                    <MachineForm\n                        initialData={selectedMachine}\n                        isCreating={isCreating}\n                        onSave={handleSaveMachine}\n                        onDelete={handleDeleteMachine}\n                        onCancel={() => { setSelectedId(null); setIsCreating(false); }}\n                    />\n                );\n            }\n        }\n\n        if (activeTab === 'belts') {\n            const selectedBelt = selectedId ? game.belts.find((belt) => belt.id === selectedId) : null;\n            if (selectedId && !selectedBelt && !isCreating) return <div>Belt not found</div>;\n\n            if (selectedBelt || isCreating) {\n                return (\n                    <BeltForm\n                        initialData={selectedBelt}\n                        isCreating={isCreating}\n                        onSave={handleSaveBelt}\n                        onDelete={handleDeleteBelt}\n                        onCancel={() => { setSelectedId(null); setIsCreating(false); }}\n                    />\n                );\n            }\n        }\n\n        if (activeTab === 'packs') {\n            return (\n                <PacksTab\n                    game={game}\n                    onResetLayout={resetLayout}\n                    onLoadPack={loadPack}\n                    onResetToDefault={resetToDefault}\n                    onImportPack={handleImport}\n                />\n            );\n        }\n\n        return <div className=\"text-gray-500 text-center mt-10\">Select an item to edit</div>;\n    };\n\n    return (\n        <div className=\"flex h-full bg-gray-900 text-white\">\n            <div className=\"w-1/3 border-r border-gray-700 flex flex-col\">\n                <div className=\"p-4 border-b border-gray-700\">\n                    <h2 className=\"text-xl font-bold mb-4\">Editor</h2>\n                    <div className=\"flex space-x-2 text-sm\">\n                        {(['items', 'recipes', 'machines', 'belts', 'packs'] as Tab[]).map((tab) => (\n                            <button\n                                key={tab}\n                                onClick={() => setActiveTab(tab)}\n                                className={`px-2 py-1 rounded ${activeTab === tab ? 'bg-blue-600' : 'hover:bg-gray-800'}`}\n                            >\n                                {tab.charAt(0).toUpperCase() + tab.slice(1)}\n                            </button>\n                        ))}\n                    </div>\n                </div>\n\n                {activeTab === 'packs' && (\n                    <div className=\"p-4 space-y-4 border-b border-gray-700\">\n                        <button\n                            onClick={() => {\n                                if (confirm('Reset all game data to DSP defaults? This will NOT clear your layout, but might break machines if current nodes use non-existent recipes.')) {\n                                    resetToDefault();\n                                }\n                            }}\n                            className=\"w-full py-2 bg-red-900/40 hover:bg-red-900/60 border border-red-500/30 rounded text-xs font-bold transition-all\"\n                        >\n                            Reset to Default (DSP)\n                        </button>\n                    </div>\n                )}\n\n                <div className=\"p-2\">\n                    <button\n                        onClick={handleCreateClick}\n                        className=\"w-full py-2 mb-2 bg-green-700 hover:bg-green-600 rounded text-sm font-bold\"\n                    >\n                        + Add {activeTab.slice(0, -1).charAt(0).toUpperCase() + activeTab.slice(1, -1)}\n                    </button>\n                    <div className=\"flex space-x-2\">\n                        <button\n                            onClick={handleImport}\n                            className=\"flex-1 py-1 bg-gray-700 hover:bg-gray-600 rounded text-xs\"\n                        >\n                            Import\n                        </button>\n                        <button\n                            onClick={handleExport}\n                            className=\"flex-1 py-1 bg-gray-700 hover:bg-gray-600 rounded text-xs\"\n                        >\n                            Export\n                        </button>\n                    </div>\n                </div>\n\n                <div className=\"flex-1 overflow-y-auto p-2\">\n                    {activeTab === 'items' && (\n                        <ItemsTab items={game.items} selectedId={selectedId} onSelect={setSelectedId} />\n                    )}\n                    {activeTab === 'recipes' && (\n                        <RecipesTab recipes={game.recipes} selectedId={selectedId} onSelect={setSelectedId} />\n                    )}\n                    {activeTab === 'machines' && (\n                        <MachinesTab machines={game.machines} selectedId={selectedId} onSelect={setSelectedId} />\n                    )}\n                    {activeTab === 'belts' && (\n                        <BeltsTab belts={game.belts} selectedId={selectedId} onSelect={setSelectedId} />\n                    )}\n                </div>\n            </div>\n\n            <div className=\"w-2/3 p-6\">\n                {renderEditor()}\n            </div>\n        </div>\n    );\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\modals\\GameDataEditor\\ItemForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\modals\\GameDataEditor\\ItemsTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\modals\\GameDataEditor\\MachineForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\modals\\GameDataEditor\\MachinesTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\modals\\GameDataEditor\\PacksTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\modals\\GameDataEditor\\RecipeForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\modals\\GameDataEditor\\RecipesTab.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\modals\\GameDataEditor\\__tests__\\GameDataEditor.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\modals\\RecipePicker\\RecipePicker.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\nodes\\SplitterNode.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[919,922],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[919,922],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":22,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[957,960],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[957,960],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { memo } from 'react';\r\nimport { Handle, Position, NodeProps } from 'reactflow';\r\nimport { SplitterNodeData, BLOCK_LAYOUT } from '@/types/block';\r\nimport { GitMerge, Filter, ArrowLeftRight, Shuffle } from 'lucide-react';\r\nimport { useLayoutStore } from '@/stores/layoutStore';\r\n\r\nconst SplitterNode = ({ id, data, selected }: NodeProps<SplitterNodeData>) => {\r\n    const updateBlock = useLayoutStore(state => state.updateBlock);\r\n    const flowMode = useLayoutStore(state => state.viewSettings.flowMode);\r\n\r\n    // Dynamic size based on mode\r\n    const width = flowMode ? 40 : 80;\r\n    const height = flowMode ? 40 : 80;\r\n\r\n    const cycleType = (e: React.MouseEvent) => {\r\n        e.stopPropagation();\r\n\r\n        // Cycle: Splitter -> Balancer -> Merger -> Splitter\r\n        const nextType = data.type === 'splitter' ? 'balancer' : (data.type === 'balancer' ? 'merger' : 'splitter');\r\n\r\n        let inputPorts: any[] = [];\r\n        let outputPorts: any[] = [];\r\n\r\n        if (nextType === 'splitter') {\r\n            inputPorts = [{ id: 'in-main', type: 'input', side: 'left', offset: 0.5, itemId: 'any', rate: 0 }];\r\n            outputPorts = [\r\n                { id: 'out-1', type: 'output', side: 'right', offset: 0.25, itemId: 'any', rate: 0 },\r\n                { id: 'out-2', type: 'output', side: 'right', offset: 0.50, itemId: 'any', rate: 0 },\r\n                { id: 'out-3', type: 'output', side: 'right', offset: 0.75, itemId: 'any', rate: 0 }\r\n            ];\r\n        } else if (nextType === 'balancer') {\r\n            inputPorts = [\r\n                { id: 'in-1', type: 'input', side: 'left', offset: 0.33, itemId: 'any', rate: 0 },\r\n                { id: 'in-2', type: 'input', side: 'left', offset: 0.66, itemId: 'any', rate: 0 }\r\n            ];\r\n            outputPorts = [\r\n                { id: 'out-1', type: 'output', side: 'right', offset: 0.33, itemId: 'any', rate: 0 },\r\n                { id: 'out-2', type: 'output', side: 'right', offset: 0.66, itemId: 'any', rate: 0 }\r\n            ];\r\n        } else {\r\n            // Merger\r\n            inputPorts = [\r\n                { id: 'in-1', type: 'input', side: 'left', offset: 0.25, itemId: 'any', rate: 0 },\r\n                { id: 'in-2', type: 'input', side: 'left', offset: 0.50, itemId: 'any', rate: 0 },\r\n                { id: 'in-3', type: 'input', side: 'left', offset: 0.75, itemId: 'any', rate: 0 }\r\n            ];\r\n            outputPorts = [{ id: 'out-main', type: 'output', side: 'right', offset: 0.5, itemId: 'any', rate: 0 }];\r\n        }\r\n\r\n        updateBlock(id, { type: nextType, inputPorts, outputPorts });\r\n    };\r\n\r\n    const cyclePriority = (e: React.MouseEvent) => {\r\n        e.stopPropagation();\r\n        const priorities: SplitterNodeData['priority'][] = ['balanced', 'out-left', 'out-right', 'in-left', 'in-right'];\r\n        const nextIdx = (priorities.indexOf(data.priority) + 1) % priorities.length;\r\n        updateBlock(id, { priority: priorities[nextIdx] });\r\n    };\r\n\r\n    if (flowMode) {\r\n        return (\r\n            <div\r\n                style={{ width, height }}\r\n                className={`\r\n                    bg-slate-900 border rounded flex items-center justify-center relative shadow-lg transition-all rotate-45\r\n                    ${selected ? 'border-amber-500 ring-2 ring-amber-500/30' : 'border-slate-700 hover:border-slate-600'}\r\n                `}\r\n                onClick={cycleType}\r\n            >\r\n                <div className=\"-rotate-45 text-white/70\">\r\n                    {data.type === 'balancer' ? <Shuffle size={16} /> : (data.type === 'splitter' ? <GitMerge className=\"rotate-90\" size={16} /> : <GitMerge className=\"-rotate-90\" size={16} />)}\r\n                </div>\r\n\r\n                {/* Handles - must adjust for rotation and smaller size */}\r\n                {data.inputPorts.map((port) => (\r\n                    <Handle\r\n                        key={port.id}\r\n                        type=\"target\"\r\n                        position={Position.Left}\r\n                        id={port.id}\r\n                        className=\"!bg-slate-900 !border-slate-500 !w-2 !h-2 z-50 !opacity-0\"\r\n                        style={{ top: '50%', left: 0 }}\r\n                    />\r\n                ))}\r\n                {data.outputPorts.map((port) => (\r\n                    <Handle\r\n                        key={port.id}\r\n                        type=\"source\"\r\n                        position={Position.Right}\r\n                        id={port.id}\r\n                        className=\"!bg-slate-900 !border-slate-500 !w-2 !h-2 z-50 !opacity-0\"\r\n                        style={{ top: '50%', right: 0 }}\r\n                    />\r\n                ))}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div\r\n            style={{ width, height }}\r\n            className={`\r\n                bg-slate-900 border rounded-full flex flex-col items-center justify-center relative shadow-lg transition-all\r\n                ${selected ? 'border-amber-500 ring-2 ring-amber-500/30' : 'border-slate-700 hover:border-slate-600'}\r\n            `}\r\n        >\r\n            {/* Center Icon */}\r\n            <div\r\n                onClick={cycleType}\r\n                className={`p-2 rounded-full cursor-pointer hover:bg-slate-700 transition-colors bg-slate-800 ${selected ? 'text-amber-500' : 'text-slate-400'}`}\r\n            >\r\n                {data.type === 'balancer' ? <Shuffle size={24} /> : (data.type === 'splitter' ? <GitMerge className=\"rotate-90\" size={24} /> : <GitMerge className=\"-rotate-90\" size={24} />)}\r\n            </div>\r\n\r\n            {/* Config Overlay */}\r\n            {selected && (\r\n                <div\r\n                    onClick={cyclePriority}\r\n                    className=\"absolute -top-12 left-1/2 -translate-x-1/2 bg-slate-800 rounded px-2 py-1 text-[10px] font-mono border border-slate-700 whitespace-nowrap z-50 flex flex-col gap-1 items-center cursor-pointer hover:border-amber-500 transition-colors\"\r\n                >\r\n                    <div className=\"font-bold text-amber-500 uppercase flex items-center gap-1\">\r\n                        <ArrowLeftRight size={10} /> {data.priority.replace('-', ' ').toUpperCase()}\r\n                    </div>\r\n                    {data.filterItemId && (\r\n                        <div className=\"text-cyan-400 flex items-center gap-1\">\r\n                            <Filter size={10} /> {data.filterItemId}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n\r\n            {/* Input Handles */}\r\n            {data.inputPorts.map((port) => (\r\n                <Handle\r\n                    key={port.id}\r\n                    type=\"target\"\r\n                    position={Position.Left}\r\n                    id={port.id}\r\n                    className=\"!bg-slate-900 !border-2 !border-slate-500 hover:!border-amber-400 !w-3 !h-3 z-50\"\r\n                    style={{\r\n                        position: 'absolute',\r\n                        left: -BLOCK_LAYOUT.HANDLE_OFFSET,\r\n                        top: height * port.offset,\r\n                        transform: 'translateY(-50%)'\r\n                    }}\r\n                />\r\n            ))}\r\n\r\n            {/* Output Handles */}\r\n            {data.outputPorts.map((port) => (\r\n                <Handle\r\n                    key={port.id}\r\n                    type=\"source\"\r\n                    position={Position.Right}\r\n                    id={port.id}\r\n                    className=\"!bg-slate-900 !border-2 !border-slate-500 hover:!border-amber-400 !w-3 !h-3 z-50\"\r\n                    style={{\r\n                        position: 'absolute',\r\n                        right: -BLOCK_LAYOUT.HANDLE_OFFSET,\r\n                        top: height * port.offset,\r\n                        transform: 'translateY(-50%)'\r\n                    }}\r\n                />\r\n            ))}\r\n\r\n            <div className=\"absolute -bottom-6 text-[9px] font-bold text-slate-500 uppercase tracking-widest\">\r\n                {data.type}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default memo(SplitterNode);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\nodes\\__tests__\\SplitterNode.test.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\components\\ui\\DSPIcon.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\data\\dsp.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\hooks\\useBlockMetrics.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\hooks\\useFactoryStats.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\hooks\\useNeedsSummary.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\lib\\io\\__tests__\\gameData.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\lib\\io\\gameData.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":97,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2951,2954],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2951,2954],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { GameDefinition } from '@/types/game';\r\nimport { z } from 'zod';\r\n\r\n// Zod schemas for runtime validation of imported data\r\nconst ItemSchema = z.object({\n    id: z.string(),\n    name: z.string(),\n    category: z.enum(['ore', 'ingot', 'component', 'product', 'science', 'fluid', 'other']),\n    stackSize: z.number(),\n    icon: z.string().optional(),\n    iconIndex: z.number().optional(),\n    isCustom: z.boolean().optional(),\n    color: z.string().optional(),\n});\n\r\nconst RecipePortSchema = z.object({\r\n    itemId: z.string(),\r\n    amount: z.number(),\r\n    probability: z.number().optional(),\r\n});\r\n\r\nconst RecipeSchema = z.object({\r\n    id: z.string(),\r\n    name: z.string(),\r\n    machineId: z.string(),\r\n    inputs: z.array(RecipePortSchema),\r\n    outputs: z.array(RecipePortSchema),\r\n    craftingTime: z.number(),\r\n    category: z.enum(['smelting', 'assembling', 'refining', 'chemical', 'research', 'mining', 'other']),\n    isCustom: z.boolean().optional(),\r\n    notes: z.string().optional(),\r\n});\r\n\r\nconst MachineSchema = z.object({\r\n    id: z.string(),\r\n    name: z.string(),\r\n    category: z.enum(['smelter', 'assembler', 'refinery', 'chemical', 'lab', 'miner', 'other']),\r\n    speed: z.number(),\r\n    size: z.object({\r\n        width: z.number(),\r\n        height: z.number(),\r\n    }),\r\n    powerUsage: z.number().optional(),\r\n    icon: z.string().optional(),\r\n    isCustom: z.boolean().optional(),\r\n    allowedCategories: z.array(z.string()).optional(), // Loose check for categories\r\n});\r\n\r\nconst BeltTierSchema = z.object({\r\n    id: z.string(),\r\n    name: z.string(),\r\n    tier: z.number(),\r\n    itemsPerSecond: z.number(),\r\n    color: z.string(),\r\n    icon: z.string().optional(),\r\n});\r\n\r\nconst GameDefinitionSchema = z.object({\r\n    id: z.enum(['dsp', 'factorio', 'satisfactory']),\r\n    name: z.string(),\r\n    version: z.string(),\r\n    items: z.array(ItemSchema),\r\n    recipes: z.array(RecipeSchema),\r\n    machines: z.array(MachineSchema),\r\n    belts: z.array(BeltTierSchema),\r\n    settings: z.object({\r\n        lanesPerBelt: z.number(),\r\n        hasSpeedModifiers: z.boolean(),\r\n        rateUnit: z.enum(['second', 'minute']),\r\n        gridSize: z.number(),\r\n        defaultMachineIds: z.record(z.string(), z.string()).optional(),\r\n    }),\r\n});\r\n\r\n/**\r\n * Validate imported game data against the schema.\r\n * Returns the parsed data or throws an error.\r\n */\r\nexport function validateGameData(data: unknown): GameDefinition {\r\n    return GameDefinitionSchema.parse(data) as GameDefinition; // Casting for complex enum types if methods match\r\n}\r\n\r\nexport interface ImportResult {\r\n    success: boolean;\r\n    data?: GameDefinition;\r\n    error?: string;\r\n}\r\n\r\n/**\r\n * Safe wrapper for importing game data.\r\n */\r\nexport function importGameData(jsonString: string): ImportResult {\r\n    try {\r\n        const raw = JSON.parse(jsonString);\r\n        const data = validateGameData(raw);\r\n        return { success: true, data };\r\n    } catch (e: any) {\r\n        return { success: false, error: e.message || 'Unknown validation error' };\r\n    }\r\n}\r\n\r\n/**\r\n * Export game data to JSON string.\r\n */\r\nexport function exportGameData(data: GameDefinition): string {\r\n    return JSON.stringify(data, null, 2);\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\lib\\io\\layoutStorage.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\lib\\layout\\blockSolver.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\lib\\layout\\edgeStatus.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":39,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1526,1529],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1526,1529],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":58,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2315,2318],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2315,2318],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":59,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2419,2422],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2419,2422],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { BeltEdgeData, BlockNode, EdgeStatus, Port, getPortPosition } from '@/types/block';\nimport { Edge } from 'reactflow';\nimport { beltItemsPerMinute } from '@/types/game';\nimport { findChannelConflicts, getChannelSegments } from '@/lib/validation/conflictDetection';\nimport { getLaneCount, Point } from '@/lib/router/channelRouter';\n\nexport const getPort = (node: BlockNode, handleId: string | null, type: 'input' | 'output'): Port | undefined => {\n    if (!handleId) return undefined;\n    const data = node.data as unknown;\n    const ports = type === 'output' ? data.outputPorts : data.inputPorts;\n    return ports?.find((port: Port) => port.id === handleId);\n};\n\nexport const updateEdgeStatus = (\n    edge: Edge,\n    nodes: BlockNode[],\n    game: unknown,\n    overrideFlow?: number,\n    overrideDemand?: number\n): Edge => {\n    const sourceNode = nodes.find((node) => node.id === edge.source);\n    const targetNode = nodes.find((node) => node.id === edge.target);\n    if (!sourceNode || !targetNode) return edge;\n\n    const sourcePort = getPort(sourceNode, edge.sourceHandle ?? null, 'output');\n    const targetPort = getPort(targetNode, edge.targetHandle ?? null, 'input');\n\n    if (!sourcePort || !targetPort) return edge;\n\n    const edgeData = (edge.data as BeltEdgeData) || {\n        beltId: game.belts[0].id,\n        capacity: beltItemsPerMinute(game.belts[0]),\n        flowRate: 0,\n        demandRate: 0,\n        status: 'ok',\n        itemId: sourcePort.itemId\n    };\n\n    const belt = game.belts.find((beltTier: any) => beltTier.id === edgeData.beltId) || game.belts[0];\n    const capacity = beltItemsPerMinute(belt);\n\n    const supplyRate = overrideFlow !== undefined ? overrideFlow : (sourcePort.currentRate !== undefined ? sourcePort.currentRate : sourcePort.rate);\n    const demandRate = overrideDemand !== undefined ? overrideDemand : targetPort.rate;\n\n    let status: EdgeStatus = 'ok';\n\n    if (sourcePort.itemId !== targetPort.itemId && targetPort.itemId !== 'any' && sourcePort.itemId !== 'any') {\n        status = 'mismatch';\n    }\n\n    if (status === 'ok' && demandRate > supplyRate + 0.001) {\n        status = 'underload';\n    }\n\n    let collisionRects: unknown[] = [];\n\n    if (status === 'ok' || status === 'underload') {\n        const p1 = getPortPosition(sourceNode.data as unknown as any, sourceNode.position, sourcePort);\n        const p2 = getPortPosition(targetNode.data as unknown as any, targetNode.position, targetPort);\n        const midX = p1.x + (p2.x - p1.x) * 0.5;\n\n        const points: Point[] = [\n            { x: p1.x, y: p1.y },\n            { x: midX, y: p1.y },\n            { x: midX, y: p2.y },\n            { x: p2.x, y: p2.y }\n        ];\n\n        const lanes = getLaneCount(supplyRate, capacity);\n        const width = (lanes - 1) * 6 + 12;\n\n        const segments = getChannelSegments(points, width);\n        collisionRects = segments;\n\n        const conflicts = findChannelConflicts(points, width, nodes);\n        const relevantConflicts = conflicts.filter((conflict) => conflict.id !== sourceNode.id && conflict.id !== targetNode.id);\n\n        if (relevantConflicts.length > 0) {\n            status = 'conflict';\n        }\n    }\n\n    return {\n        ...edge,\n        data: {\n            ...edgeData,\n            capacity,\n            flowRate: supplyRate,\n            demandRate,\n            status,\n            collisionRects\n        }\n    };\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\lib\\layout\\manifoldSolver.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\lib\\router\\channelRouter.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\lib\\router\\pathfinder.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\lib\\router\\routeSolver.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1258,1261],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1258,1261],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":35,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1285,1288],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1285,1288],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1370,1373],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1370,1373],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1396,1399],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1396,1399],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { Edge } from 'reactflow';\r\nimport { BlockNode, getPortPosition } from '@/types/block';\r\nimport { Pathfinder, Obstacle } from './pathfinder';\r\nimport { Point } from './channelRouter';\r\n\r\n/**\r\n * Recalculates paths for all edges in the layout.\r\n * Ensures paths respect obstacles and avoid same-alignment overlap.\r\n */\r\nexport function solveAllRoutes(nodes: BlockNode[], edges: Edge[]): Edge[] {\r\n    const obstacles: Obstacle[] = nodes.map(node => {\r\n        const size = node.data.size || { width: 80, height: 80 };\r\n        return {\r\n            x: node.position.x,\r\n            y: node.position.y,\r\n            width: size.width,\r\n            height: size.height\r\n        };\r\n    });\r\n\r\n    const segments: { p1: Point, p2: Point, dir: 'h' | 'v' }[] = [];\r\n\r\n    // Process edges in a deterministic order (e.g. by ID)\r\n    const sortedEdges = [...edges].sort((a, b) => a.id.localeCompare(b.id));\r\n\r\n    return sortedEdges.map(edge => {\r\n        const sourceNode = nodes.find(n => n.id === edge.source);\r\n        const targetNode = nodes.find(n => n.id === edge.target);\r\n\r\n        if (!sourceNode || !targetNode || !edge.sourceHandle || !edge.targetHandle) {\r\n            return edge;\r\n        }\r\n\r\n        const sourcePort = (sourceNode.data as any).outputPorts?.find((p: any) => p.id === edge.sourceHandle);\r\n        const targetPort = (targetNode.data as any).inputPorts?.find((p: any) => p.id === edge.targetHandle);\r\n\r\n        if (!sourcePort || !targetPort) return edge;\r\n\r\n        const start = getPortPosition(sourceNode.data, sourceNode.position, sourcePort);\r\n        const end = getPortPosition(targetNode.data, targetNode.position, targetPort);\r\n\r\n        const finder = new Pathfinder(obstacles, segments);\r\n        const path = finder.findPath(start, end);\r\n\r\n        // Add these segments to the global occupancy map for subsequent edges\r\n        for (let i = 0; i < path.length - 1; i++) {\r\n            const p1 = path[i];\r\n            const p2 = path[i + 1];\r\n            const dir = Math.abs(p1.y - p2.y) < 1 ? 'h' : 'v';\r\n            segments.push({ p1, p2, dir });\r\n        }\r\n\r\n        return {\r\n            ...edge,\r\n            data: {\r\n                ...edge.data,\r\n                points: path\r\n            }\r\n        };\r\n    });\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\lib\\solver\\__tests__\\flowSolver.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\lib\\solver\\__tests__\\rateSolver.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\lib\\solver\\flowDemand.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":27,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[984,987],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[984,987],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Edge } from 'reactflow';\nimport { BlockNode } from '@/types/block';\n\nexport const getTargetDemand = (\n    targetNodeId: string,\n    targetHandleId: string,\n    nodes: BlockNode[],\n    edges: Edge[],\n    visited: Set<string> = new Set()\n): number => {\n    const key = `${targetNodeId}-${targetHandleId}-input`;\n    if (visited.has(key)) return 0;\n    visited.add(key);\n\n    const node = nodes.find((candidate) => candidate.id === targetNodeId);\n    if (!node) return 0;\n\n    if (node.type === 'block') {\n        const data = node.data as unknown as { inputPorts?: Array<{ id: string; rate?: number }> };\n        const port = data.inputPorts?.find((p) => p.id === targetHandleId);\n        return port?.rate ?? 0;\n    }\n\n    if (node.type === 'splitter') {\n        const data = node.data as unknown as { outputPorts?: Array<{ id: string }> };\n        const totalOutDemand = data.outputPorts?.reduce((sum: number, port) =>\n            sum + getDownstreamDemand(node.id, (port as any).id, nodes, edges, visited), 0\n        ) ?? 0;\n        const incoming = edges.filter((edge) => edge.target === node.id);\n        return totalOutDemand / Math.max(1, incoming.length);\n    }\n\n    return 0;\n};\n\nexport const getDownstreamDemand = (\n    nodeId: string,\n    portId: string,\n    nodes: BlockNode[],\n    edges: Edge[],\n    visited: Set<string> = new Set()\n): number => {\n    const key = `${nodeId}-${portId}-output`;\n    if (visited.has(key)) return 0;\n    visited.add(key);\n\n    const outgoingEdges = edges.filter((edge) => edge.source === nodeId && edge.sourceHandle === portId);\n    if (outgoingEdges.length === 0) return 0;\n\n    return outgoingEdges.reduce((sum, edge) => {\n        return sum + getTargetDemand(edge.target, edge.targetHandle!, nodes, edges, visited);\n    }, 0);\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\lib\\solver\\flowSolver.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\lib\\solver\\layoutFlowSolver.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":233,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":233,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10669,10672],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10669,10672],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":237,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":237,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10801,10804],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10801,10804],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":237,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":237,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10833,10836],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10833,10836],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":238,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":238,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10905,10908],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10905,10908],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":238,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":238,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10946,10949],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10946,10949],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Edge } from 'reactflow';\nimport { BeltEdgeData, BlockNode, Port, Block, SplitterNodeData } from '@/types/block';\nimport { findNodeConflicts } from '@/lib/validation/conflictDetection';\nimport { getDownstreamDemand, getTargetDemand } from '@/lib/solver/flowDemand';\nimport { getPort, updateEdgeStatus } from '@/lib/layout/edgeStatus';\nimport { solveAllRoutes } from '@/lib/router/routeSolver';\n\ninterface FlowSolveState {\n    nodes: BlockNode[];\n    edges: Edge[];\n    nodeConflicts: Set<string>;\n}\n\ninterface FlowSolveOptions {\n    skipRateSolver?: boolean;\n}\n\nexport const recalculateLayoutFlows = (\n    state: FlowSolveState,\n    game: unknown,\n    options?: FlowSolveOptions\n) => {\n    state.nodeConflicts = findNodeConflicts(state.nodes);\n\n    if (!options?.skipRateSolver) {\n        state.nodes.forEach((node) => {\n            const data = node.data as Block | SplitterNodeData;\n            if ('outputPorts' in data) {\n                data.outputPorts.forEach((port: Port) => {\n                    port.currentRate = (node.type === 'splitter' ? 0 : port.rate);\n                });\n            }\n            if ('inputPorts' in data) {\n                data.inputPorts.forEach((port: Port) => {\n                    port.currentRate = undefined;\n                });\n            }\n        });\n\n        const ITERATIONS = 15;\n        const connectedInputs = new Set(state.edges.map((edge) => `${edge.target}-${edge.targetHandle}`));\n\n        for (let i = 0; i < ITERATIONS; i++) {\n            let changed = false;\n            const inputFlows = new Map<string, number>();\n\n            const edgesBySource = new Map<string, Edge[]>();\n            state.edges.forEach((edge) => {\n                const key = `${edge.source}-${edge.sourceHandle}`;\n                const group = edgesBySource.get(key) || [];\n                group.push(edge);\n                edgesBySource.set(key, group);\n            });\n\n            edgesBySource.forEach((group) => {\n                const firstEdge = group[0];\n                const sourceNode = state.nodes.find((node) => node.id === firstEdge.source);\n                if (!sourceNode) return;\n                const sourcePort = getPort(sourceNode, firstEdge.sourceHandle ?? null, 'output');\n                if (!sourcePort) return;\n\n                const totalAvailable = sourcePort.currentRate ?? 0;\n                if (group.length === 1) {\n                    const targetKey = `${firstEdge.target}-${firstEdge.targetHandle}`;\n                    inputFlows.set(targetKey, (inputFlows.get(targetKey) || 0) + totalAvailable);\n                } else {\n                    const demands = group.map((edge) => getTargetDemand(edge.target, edge.targetHandle!, state.nodes, state.edges));\n                    const totalDemand = demands.reduce((sum, value) => sum + value, 0);\n                    group.forEach((edge, index) => {\n                        const share = totalDemand > 0 ? (demands[index] / totalDemand) : (1 / group.length);\n                        const flow = totalAvailable * share;\n                        const targetKey = `${edge.target}-${edge.targetHandle}`;\n                        inputFlows.set(targetKey, (inputFlows.get(targetKey) || 0) + flow);\n                    });\n                }\n            });\n\n            state.nodes.forEach((node) => {\n                const data = node.data as unknown;\n\n                if (node.type === 'block') {\n                    const blockData = data as Block;\n                    let satisfaction = 1.0;\n                    if (blockData.inputPorts.length > 0) {\n                        const satisfactions = blockData.inputPorts.map((port: Port) => {\n                            if (port.rate <= 0) return 1.0;\n                            const key = `${node.id}-${port.id}`;\n                            if (!connectedInputs.has(key)) return 1.0;\n\n                            const incoming = inputFlows.get(key) || 0;\n                            return Math.min(1.0, incoming / port.rate);\n                        });\n                        satisfaction = Math.min(...satisfactions);\n                    }\n                    blockData.outputPorts.forEach((port: Port) => {\n                        const newRate = port.rate * satisfaction;\n                        if (Math.abs((port.currentRate ?? 0) - newRate) > 0.001) {\n                            port.currentRate = newRate;\n                            changed = true;\n                        }\n                    });\n                } else if (node.type === 'splitter') {\n                    const splitterData = data as SplitterNodeData;\n                    const totalIn = splitterData.inputPorts.reduce((sum: number, port: Port) => sum + (inputFlows.get(`${node.id}-${port.id}`) || 0), 0);\n                    const outputs = splitterData.outputPorts as Port[];\n                    if (outputs.length === 0) return;\n\n                    const demands = outputs.map((port: Port) => getDownstreamDemand(node.id, port.id, state.nodes, state.edges));\n                    const totalDemand = demands.reduce((sum, value) => sum + value, 0);\n\n                    const incomingEdges = state.edges.filter((edge) => edge.target === node.id);\n                    const incomingItem = incomingEdges.map((edge) => {\n                        const sourceNode = state.nodes.find((nodeItem) => nodeItem.id === edge.source);\n                        if (!sourceNode) return null;\n                        return getPort(sourceNode, edge.sourceHandle ?? null, 'output');\n                    }).find((port) => port && port.itemId !== 'any')?.itemId || 'any';\n\n                    if (splitterData.inputPorts[0]?.itemId !== incomingItem) {\n                        changed = true;\n                        splitterData.inputPorts.forEach((port: Port) => { port.itemId = incomingItem; });\n                        splitterData.outputPorts.forEach((port: Port) => { port.itemId = incomingItem; });\n                    }\n\n                    const connectedInputPorts = splitterData.inputPorts.filter((port: Port) => connectedInputs.has(`${node.id}-${port.id}`));\n                    const totalCurrentSupply = connectedInputPorts.reduce((sum: number, port: Port) => sum + (inputFlows.get(`${node.id}-${port.id}`) || 0), 0);\n\n                    splitterData.inputPorts.forEach((port: Port) => {\n                        const key = `${node.id}-${port.id}`;\n                        if (!connectedInputs.has(key)) {\n                            port.rate = 0;\n                            return;\n                        }\n\n                        const mySupply = inputFlows.get(key) || 0;\n                        if (totalCurrentSupply >= totalDemand) {\n                            port.rate = mySupply;\n                        } else if (totalCurrentSupply === 0) {\n                            port.rate = totalDemand / connectedInputPorts.length;\n                        } else {\n                            port.rate = (mySupply / totalCurrentSupply) * totalDemand;\n                        }\n                    });\n\n                    let newRates: number[] = [];\n\n                    if (splitterData.priority === 'balanced' || !splitterData.priority) {\n                        if (totalDemand > 0) {\n                            newRates = demands.map((demand) => (demand / totalDemand) * totalIn);\n                        } else {\n                            const share = totalIn / outputs.length;\n                            newRates = outputs.map(() => share);\n                        }\n                    } else if (splitterData.priority === 'out-left' || splitterData.priority === 'out-right') {\n                        const prioIdx = splitterData.priority === 'out-left' ? 0 : 1;\n                        const otherIdx = prioIdx === 0 ? 1 : 0;\n\n                        const prioTake = Math.min(totalIn, demands[prioIdx]);\n                        newRates = [];\n                        newRates[prioIdx] = prioTake;\n\n                        const remaining = totalIn - prioTake;\n                        newRates[otherIdx] = remaining;\n\n                        if (totalIn > 0 && totalDemand === 0) {\n                            newRates[prioIdx] = totalIn;\n                            newRates[otherIdx] = 0;\n                        }\n                    } else {\n                        const share = totalIn / outputs.length;\n                        newRates = outputs.map(() => share);\n                    }\n\n                    outputs.forEach((port: Port, index: number) => {\n                        const newRate = newRates[index] || 0;\n                        const demand = demands[index] || 0;\n\n                        port.rate = demand;\n\n                        if (Math.abs((port.currentRate ?? 0) - newRate) > 0.001) {\n                            port.currentRate = newRate;\n                            changed = true;\n                        }\n                    });\n                }\n            });\n\n            if (!changed) break;\n        }\n    }\n\n    const edgeFlows = new Map<string, number>();\n    const edgeDemands = new Map<string, number>();\n\n    const edgesBySourceGroup = new Map<string, Edge[]>();\n    state.edges.forEach((edge) => {\n        const key = `${edge.source}-${edge.sourceHandle}`;\n        const group = edgesBySourceGroup.get(key) || [];\n        group.push(edge);\n        edgesBySourceGroup.set(key, group);\n    });\n\n    edgesBySourceGroup.forEach((group) => {\n        const firstEdge = group[0];\n        const sourceNode = state.nodes.find((node) => node.id === firstEdge.source);\n        if (!sourceNode) return;\n        const sourcePort = getPort(sourceNode, firstEdge.sourceHandle ?? null, 'output');\n        if (!sourcePort) return;\n\n        const totalAvailable = sourcePort.currentRate ?? 0;\n        const demands = group.map((edge) => getTargetDemand(edge.target, edge.targetHandle!, state.nodes, state.edges));\n        const totalDemand = demands.reduce((sum, value) => sum + value, 0);\n\n        group.forEach((edge, index) => {\n            const share = totalDemand > 0 ? (demands[index] / totalDemand) : (1 / group.length);\n            edgeFlows.set(edge.id, totalAvailable * share);\n            edgeDemands.set(edge.id, demands[index]);\n        });\n    });\n\n    state.edges = state.edges.map((edge) => {\n        const flow = edgeFlows.get(edge.id);\n        const demand = edgeDemands.get(edge.id);\n        return updateEdgeStatus(edge, state.nodes, game, flow, demand);\n    });\n\n    // Solve paths for all edges\n    state.edges = solveAllRoutes(state.nodes, state.edges);\n};\n\nexport const updateEdgeBeltTier = (\n    edge: Edge,\n    nodes: BlockNode[],\n    game: any\n): Edge => {\n    if (!edge.data) return edge;\n    const beltData = edge.data as BeltEdgeData;\n    const currentIndex = (game as any).belts.findIndex((beltTier: any) => beltTier.id === beltData.beltId);\n    const nextBelt = (game as any).belts[(currentIndex + 1) % (game as any).belts.length];\n    beltData.beltId = nextBelt.id;\n    const updated = updateEdgeStatus(edge, nodes, game);\n    return { ...edge, data: updated.data };\n};\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\lib\\solver\\rateSolver.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\lib\\ui\\edgeStyles.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\lib\\utils\\stringUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\lib\\validation\\__tests__\\conflictDetection.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\lib\\validation\\__tests__\\gameValidators.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\lib\\validation\\conflictDetection.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[986,989],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[986,989],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { BlockNode } from '@/types/block';\r\nimport { Point } from '@/lib/router/channelRouter';\r\n\r\nexport interface Rect {\r\n    x: number;\r\n    y: number;\r\n    width: number;\r\n    height: number;\r\n}\r\n\r\n/**\r\n * Checks if nodes (Blocks/Splitters) intersect with each other.\r\n * Returns a Set of Node IDs that are in conflict.\r\n */\r\nexport function findNodeConflicts(nodes: BlockNode[]): Set<string> {\r\n    const overlapping = new Set<string>();\r\n\r\n    for (let i = 0; i < nodes.length; i++) {\r\n        for (let j = i + 1; j < nodes.length; j++) {\r\n            const n1 = nodes[i];\r\n            const n2 = nodes[j];\r\n\r\n            const r1 = getNodeRect(n1);\r\n            const r2 = getNodeRect(n2);\r\n\r\n            if (r1 && r2 && isIntersecting(r1, r2)) {\r\n                overlapping.add(n1.id);\r\n                overlapping.add(n2.id);\r\n            }\r\n        }\r\n    }\r\n\r\n    return overlapping;\r\n}\r\n\r\nfunction getNodeRect(node: BlockNode): Rect | null {\r\n    const data = node.data as any;\r\n    if (!data.size) return null;\r\n    return {\r\n        x: node.position.x,\r\n        y: node.position.y,\r\n        width: data.size.width,\r\n        height: data.size.height\r\n    };\r\n}\r\n\r\n/**\r\n * Shared utility to get the actual collision rectangles for a channel.\r\n * Used by both the logic engine and the debug renderer.\r\n */\r\nexport function getChannelSegments(points: Point[], width: number): Rect[] {\r\n    const segments: Rect[] = [];\r\n    const halfWidth = width / 2;\r\n\r\n    for (let i = 0; i < points.length - 1; i++) {\r\n        const p1 = points[i];\r\n        const p2 = points[i + 1];\r\n        const isHorizontal = Math.abs(p1.y - p2.y) < 0.1;\r\n\r\n        // Determine if endpoints are internal corners (connected to other segments)\r\n        const isP1Corner = i > 0;\r\n        const isP2Corner = i < points.length - 2;\r\n\r\n        if (isHorizontal) {\r\n            let minX = Math.min(p1.x, p2.x);\r\n            let maxX = Math.max(p1.x, p2.x);\r\n\r\n            // Extend if corner\r\n            if (p1.x < p2.x) { // p1 is left (min), p2 is right (max)\r\n                if (isP1Corner) minX -= halfWidth;\r\n                if (isP2Corner) maxX += halfWidth;\r\n            } else { // p2 is left (min), p1 is right (max)\r\n                if (isP2Corner) minX -= halfWidth;\r\n                if (isP1Corner) maxX += halfWidth;\r\n            }\r\n\r\n            segments.push({\r\n                x: minX,\r\n                y: p1.y - halfWidth,\r\n                width: maxX - minX,\r\n                height: width\r\n            });\r\n        } else {\r\n            let minY = Math.min(p1.y, p2.y);\r\n            let maxY = Math.max(p1.y, p2.y);\r\n\r\n            // Extend if corner\r\n            if (p1.y < p2.y) { // p1 is top (min), p2 is bottom (max)\r\n                if (isP1Corner) minY -= halfWidth;\r\n                if (isP2Corner) maxY += halfWidth;\r\n            } else { // p2 is top (min), p1 is bottom (max)\r\n                if (isP2Corner) minY -= halfWidth;\r\n                if (isP1Corner) maxY += halfWidth;\r\n            }\r\n\r\n            segments.push({\r\n                x: p1.x - halfWidth,\r\n                y: minY,\r\n                width: width,\r\n                height: maxY - minY\r\n            });\r\n        }\r\n    }\r\n    return segments;\r\n}\r\n\r\n/**\r\n * Checks if a Channel (defined by points and a total width)\r\n * intersects with any of the valid nodes.\r\n */\r\nexport function findChannelConflicts(points: Point[], width: number, nodes: BlockNode[]): BlockNode[] {\r\n    if (points.length < 2) return [];\r\n\r\n    const conflicts: BlockNode[] = [];\r\n    const segments = getChannelSegments(points, width);\r\n\r\n    // 2. Check against all Nodes\r\n    for (const node of nodes) {\r\n        const blockRect = getNodeRect(node);\r\n        if (!blockRect) continue;\r\n\r\n        let hasHit = false;\r\n        for (const seg of segments) {\r\n            if (isIntersecting(seg, blockRect)) {\r\n                hasHit = true;\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (hasHit) {\r\n            conflicts.push(node);\r\n        }\r\n    }\r\n\r\n    return conflicts;\r\n}\r\n\r\nfunction isIntersecting(r1: Rect, r2: Rect): boolean {\r\n    return !(\r\n        r2.x >= r1.x + r1.width ||\r\n        r2.x + r2.width <= r1.x ||\r\n        r2.y >= r1.y + r1.height ||\r\n        r2.y + r2.height <= r1.y\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\lib\\validation\\gameValidators.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\scripts\\validate-phase1.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\stores\\__tests__\\advancedSystems.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\stores\\__tests__\\byproduct.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\stores\\__tests__\\conflictLogic.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\stores\\__tests__\\demandSharing.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\stores\\__tests__\\gameStore.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\stores\\__tests__\\layoutStore.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\stores\\__tests__\\loop.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\stores\\__tests__\\modifier.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\stores\\__tests__\\persistence.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\stores\\gameStore.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":142,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5561,5564],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5561,5564],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand';\r\nimport { produce } from 'immer';\r\nimport { persist, createJSONStorage } from 'zustand/middleware';\r\nimport { GameDefinition, Item, Machine, Recipe, BeltTier } from '@/types/game';\r\nimport { DSP_DATA } from '@/data/dsp';\r\n\r\ninterface GameState {\r\n    game: GameDefinition;\r\n\r\n    // Helpers\r\n    getRecipe: (id: string) => Recipe | undefined;\r\n    getItem: (id: string) => Item | undefined;\r\n    getMachine: (id: string) => Machine | undefined;\r\n\r\n    // CRUD Actions\r\n    // Recipes\r\n    addRecipe: (recipe: Recipe) => void;\r\n    updateRecipe: (id: string, updates: Partial<Recipe>) => void;\r\n    deleteRecipe: (id: string) => void;\r\n\r\n    // Items\r\n    addItem: (item: Item) => void;\r\n    updateItem: (id: string, updates: Partial<Item>) => void;\r\n    deleteItem: (id: string) => void;\r\n\r\n    // Machines\r\n    addMachine: (machine: Machine) => void;\r\n    updateMachine: (id: string, updates: Partial<Machine>) => void;\r\n    deleteMachine: (id: string) => void;\r\n\r\n    // Belts\r\n    addBelt: (belt: BeltTier) => void;\r\n    updateBelt: (id: string, updates: Partial<BeltTier>) => void;\r\n    deleteBelt: (id: string) => void;\r\n\r\n    // Bulk Load (for importing packs)\r\n    loadGameData: (data: GameDefinition) => void;\r\n    loadPack: (url: string) => Promise<void>;\r\n    resetToDefault: () => void;\r\n}\r\n\r\nexport const useGameStore = create<GameState>()(\r\n    persist(\r\n        (set, get) => ({\r\n            game: DSP_DATA,\r\n\r\n            // ─── Helpers ──────────────────────────────────────────\r\n\r\n            getRecipe: (id) => get().game.recipes.find(r => r.id === id),\r\n            getItem: (id) => get().game.items.find(i => i.id === id),\r\n            getMachine: (id) => get().game.machines.find(m => m.id === id),\r\n\r\n            // ─── CRUD Actions ─────────────────────────────────────\r\n\r\n            // Recipes\r\n            addRecipe: (recipe) => set(produce((state: GameState) => {\r\n                // Prevent duplicates\r\n                if (state.game.recipes.find(r => r.id === recipe.id)) return;\r\n                state.game.recipes.push(recipe);\r\n            })),\r\n\r\n            updateRecipe: (id, updates) => set(produce((state: GameState) => {\r\n                const index = state.game.recipes.findIndex(r => r.id === id);\r\n                if (index !== -1) {\r\n                    state.game.recipes[index] = { ...state.game.recipes[index], ...updates };\r\n                }\r\n            })),\r\n\r\n            deleteRecipe: (id) => set(produce((state: GameState) => {\r\n                state.game.recipes = state.game.recipes.filter(r => r.id !== id);\r\n            })),\r\n\r\n            // Items\r\n            addItem: (item) => set(produce((state: GameState) => {\r\n                if (state.game.items.find(i => i.id === item.id)) return;\r\n                state.game.items.push(item);\r\n            })),\r\n\r\n            updateItem: (id, updates) => set(produce((state: GameState) => {\r\n                const index = state.game.items.findIndex(i => i.id === id);\r\n                if (index !== -1) {\r\n                    state.game.items[index] = { ...state.game.items[index], ...updates };\r\n                }\r\n            })),\r\n\r\n            deleteItem: (id) => set(produce((state: GameState) => {\r\n                state.game.items = state.game.items.filter(i => i.id !== id);\r\n            })),\r\n\r\n            // Machines\r\n            addMachine: (machine) => set(produce((state: GameState) => {\r\n                if (state.game.machines.find(m => m.id === machine.id)) return;\r\n                state.game.machines.push(machine);\r\n            })),\r\n\r\n            updateMachine: (id, updates) => set(produce((state: GameState) => {\r\n                const index = state.game.machines.findIndex(m => m.id === id);\r\n                if (index !== -1) {\r\n                    state.game.machines[index] = { ...state.game.machines[index], ...updates };\r\n                }\r\n            })),\r\n\r\n            deleteMachine: (id) => set(produce((state: GameState) => {\r\n                state.game.machines = state.game.machines.filter(m => m.id !== id);\r\n            })),\r\n\r\n            // Belts\r\n            addBelt: (belt) => set(produce((state: GameState) => {\r\n                if (state.game.belts.find(b => b.id === belt.id)) return;\r\n                state.game.belts.push(belt);\r\n            })),\r\n\r\n            updateBelt: (id, updates) => set(produce((state: GameState) => {\r\n                const index = state.game.belts.findIndex(b => b.id === id);\r\n                if (index !== -1) {\r\n                    state.game.belts[index] = { ...state.game.belts[index], ...updates };\r\n                }\r\n            })),\r\n\r\n            deleteBelt: (id) => set(produce((state: GameState) => {\r\n                state.game.belts = state.game.belts.filter(b => b.id !== id);\r\n            })),\r\n\r\n            // data management\r\n            loadGameData: (data) => set({ game: data }),\r\n            loadPack: async (url) => {\r\n                try {\r\n                    const response = await fetch(url);\r\n                    const data = await response.json();\r\n                    set({ game: data });\r\n                } catch (e) {\r\n                    console.error('Failed to load pack:', e);\r\n                    alert('Failed to load game pack.');\r\n                }\r\n            },\r\n            resetToDefault: () => set({ game: DSP_DATA }),\r\n        }),\r\n        {\r\n            name: 'dsp_game_data',\r\n            storage: createJSONStorage(() => localStorage),\r\n            version: 1,\r\n            migrate: (persistedState: any, version: number) => {\r\n                if (version === 0 && persistedState?.game?.spriteSheet) {\r\n                    const brokenUrl = 'https://raw.githubusercontent.com/daletom/dsp-planner/main/src/assets/icons.png';\r\n                    if (persistedState.game.spriteSheet.url === brokenUrl) {\r\n                        persistedState.game.spriteSheet.url = '/icons.png';\r\n                    }\r\n                }\r\n                return persistedState;\r\n            }\r\n        }\r\n    )\r\n);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\stores\\layoutStore.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\tests\\setup.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\types\\__tests__\\block.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\types\\block.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1276,1279],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1276,1279],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":175,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":175,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4843,4846],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4843,4846],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":176,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4900,4903],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4900,4903],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Node, XYPosition } from 'reactflow';\r\nexport type PortSide = 'top' | 'bottom' | 'left' | 'right';\r\n\r\n/**\r\n * An input or output connection point on a block.\r\n */\r\nexport interface Port {\r\n    id: string; // Unique within block\r\n    type: 'input' | 'output';\r\n\r\n    /** Which item flows through this port */\r\n    itemId: string;\r\n\r\n    /** Rate in items per minute */\r\n    rate: number;\r\n\r\n    /** Which side of the block */\r\n    side: PortSide;\r\n\r\n    /** Offset along that side (0 = start, 1 = end) */\r\n    offset: number; // 0.0 to 1.0\r\n\r\n    /** Which belt lanes this uses (for multi-lane games) */\r\n    lanes?: number[]; // [0], [1], [0, 1]\r\n\r\n    /** \r\n     * Actual flow rate after upstream starvation/constraints.\r\n     * If undefined, assume == rate.\r\n     */\r\n    currentRate?: number;\r\n}\r\n\r\nexport type EdgeStatus = 'ok' | 'bottleneck' | 'overload' | 'underload' | 'mismatch' | 'conflict';\r\n\r\nexport interface BeltEdgeData {\r\n    beltId: string;\r\n    flowRate: number; // Actual items/min currently flowing\r\n    demandRate: number; // What the consumer actually needs/requests\r\n    capacity: number; // Max items/min for this belt tier\r\n    status: EdgeStatus;\r\n    itemId: string;\r\n    pathOffset?: number; // 0.0 to 1.0, default 0.5\r\n    collisionRects?: any[];\r\n    points?: { x: number, y: number }[];\r\n}\r\n\r\nexport interface Position {\r\n    x: number;\r\n    y: number;\r\n}\r\n\r\nexport interface Size {\r\n    width: number;\r\n    height: number;\r\n}\r\n\r\n/**\r\n * A production block - the core building unit.\r\n * Represents a self-contained production setup (e.g., \"6 smelters making iron plates\").\r\n */\r\nexport interface Block {\r\n    id: string; // Unique ID (UUID)\r\n    name: string; // User-editable label\r\n\r\n    /** Recipe this block produces */\r\n    recipeId: string;\r\n\r\n    /** Machine variant for this block (optional override) */\r\n    machineId?: string; // \"arc-smelter-mk2\"\r\n\r\n    /** Calculation mode: output driven or machine count driven */\r\n    calculationMode: 'output' | 'machines';\r\n\r\n    /** Target output rate (items per minute) */\r\n    targetRate: number;\r\n\r\n    /** Target number of machines (when mode is 'machines') */\r\n    targetMachineCount?: number;\r\n\r\n    /** Visual size (calculated from machine count) */\r\n    size: Size;\r\n\r\n    // ─── Calculated Fields ───────────────────────────────\r\n\r\n    /** Number of machines needed to hit target rate */\r\n    machineCount: number;\r\n\r\n    /** Actual output rate (may differ due to rounding) */\r\n    actualRate: number;\r\n\r\n    /** Input ports (items this block needs) */\r\n    inputPorts: Port[];\r\n\r\n    /** Output ports (items this block produces) */\r\n    outputPorts: Port[];\r\n\r\n    // ─── Optional ────────────────────────────────────────\r\n\r\n    /** Internal layout (shown when expanded) */\r\n    internalLayout?: InternalLayout;\r\n\r\n    /** Machine speed modifier (proliferator, etc.) */\r\n    speedModifier?: number; // 1.0 = 100%, 1.25 = 125%\r\n\r\n    /** User notes */\r\n    notes?: string;\r\n\r\n    /** For byproduct recipes: primary output item */\r\n    primaryOutputId?: string;\r\n\r\n    /** Speed/productivity modifier settings */\r\n    modifier?: {\r\n        type: 'none' | 'speed' | 'productivity';\r\n        level: number;\r\n        includeConsumption: boolean;\r\n    };\r\n\r\n    /** Production loop identifier, if applicable */\r\n    loopId?: string;\r\n\r\n    /** Room/floor this block belongs to */\r\n    containerId?: string;\r\n\r\n    /** Calculated production efficiency (0.0 to 1.0) */\r\n    efficiency: number;\r\n}\r\n\r\n// ─── Splitters ──────────────────────────────────────────────\r\n\r\nexport interface SplitterNodeData {\r\n    id: string;\r\n    size?: Size;\r\n    type: 'splitter' | 'merger' | 'balancer';\r\n\r\n    // Splitters are simpler than blocks - strict 1:2 or 2:1 mapping usually\r\n    // But we keep the generic port structure for consistency\r\n    inputPorts: Port[];\r\n    outputPorts: Port[];\r\n\r\n    priority: 'balanced' | 'in-left' | 'in-right' | 'out-left' | 'out-right';\r\n    filterItemId?: string; // If filtered, which item (usually on priority output)\r\n}\r\n\r\nexport interface BlockNode extends Node<Block | SplitterNodeData> {\r\n    origin?: [number, number];\r\n}\r\n\r\nexport function isBlock(data: Block | SplitterNodeData): data is Block {\r\n    return 'recipeId' in data;\r\n}\r\n\r\nexport const BLOCK_LAYOUT = {\r\n    HEADER: 98,\r\n    WIDTH: 380,\r\n    HEADER_TOP_HEIGHT: 64,\r\n    HEADER_CONTROLS_HEIGHT: 34,\r\n    PADDING: 10,\r\n    PORT_LABEL: 24,\r\n    PORT_ROW: 40,\r\n    PORT_GAP: 10,\r\n    FOOTER: 30,\r\n    HANDLE_OFFSET: 4, // The 4px the handle pokes out\r\n    CENTER_BODY_MIN_HEIGHT: 46 // Height of the \"Required\" box area\r\n};\r\n\r\n\r\n/**\r\n * Calculate absolute position of a port on canvas.\r\n */\r\nexport function getPortPosition(\r\n    nodeData: Block | SplitterNodeData,\r\n    nodePosition: XYPosition,\r\n    port: Port\r\n): XYPosition {\r\n    const width = (nodeData as any).size?.width || 80;\r\n    const height = (nodeData as any).size?.height || 80;\r\n    const { x, y } = nodePosition;\r\n\r\n    // Splitter Logic\r\n    if (!('recipeId' in nodeData)) {\r\n        const splitterX = port.side === 'left' ? x - BLOCK_LAYOUT.HANDLE_OFFSET : x + width + BLOCK_LAYOUT.HANDLE_OFFSET;\r\n        return { x: splitterX, y: y + height * port.offset };\r\n    }\r\n\r\n    // Building Logic\r\n    const { HEADER, PORT_LABEL, PORT_ROW, PORT_GAP, HANDLE_OFFSET } = BLOCK_LAYOUT;\r\n\r\n    switch (port.side) {\r\n        case 'top': return { x: x + width * port.offset, y: y - HANDLE_OFFSET };\r\n        case 'bottom': return { x: x + width * port.offset, y: y + height + HANDLE_OFFSET };\r\n        case 'left':\r\n        case 'right': {\r\n            const ports = port.type === 'input' ? nodeData.inputPorts : nodeData.outputPorts;\r\n            const index = ports.findIndex(p => p.id === port.id);\r\n            const safeIndex = index === -1 ? 0 : index;\r\n\r\n            const topOffset = HEADER + PORT_LABEL;\r\n            const rowCenter = topOffset + (safeIndex * (PORT_ROW + PORT_GAP)) + (PORT_ROW / 2);\r\n\r\n            const buildingX = port.side === 'left' ? x - HANDLE_OFFSET : x + width + HANDLE_OFFSET;\r\n            return { x: buildingX, y: y + rowCenter };\r\n        }\r\n    }\r\n    return { x, y };\r\n}\r\n\r\n// ─── Internal Layout ────────────────────────────────────────\r\n\r\n/**\r\n * How machines are arranged inside a block (expandable view).\r\n */\r\nexport interface InternalLayout {\r\n    /** Machine positions within the block */\r\n    machines: MachinePlacement[];\r\n\r\n    /** Internal belt routing */\r\n    internalBelts: InternalBelt[];\r\n\r\n    /** Overall arrangement pattern */\r\n    pattern: LayoutPattern;\r\n}\r\n\r\nexport interface MachinePlacement {\r\n    index: number; // 0, 1, 2, ...\r\n    position: Position; // Relative to block origin\r\n    rotation: 0 | 90 | 180 | 270; // Degrees\r\n}\r\n\r\nexport interface InternalBelt {\r\n    fromMachine: number | 'input'; // Machine index or port\r\n    toMachine: number | 'output';\r\n    path: Position[]; // Waypoints\r\n    itemId: string;\r\n}\r\n\r\nexport type LayoutPattern =\r\n    | 'linear' // Single row\r\n    | 'double-row' // Two rows facing each other\r\n    | 'grid' // Grid arrangement\r\n    | 'custom'; // User-defined\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\types\\connection.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\types\\game.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\types\\layout.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\types\\ui.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\src\\vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\tailwind.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\prodo\\Antigrav projects\\DSP\\dsp-planner\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]